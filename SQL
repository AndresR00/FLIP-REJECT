SELECT *,
CASE
  WHEN SYM_REJECT_REASON = 'CustomerRejected' THEN WM_REJECT_REASON
  ELSE SYM_REJECT_REASON
END REJECT_REASON
FROM (
SELECT
DATE(BUSINESS_DATE) AS DATE,
LPN,
SKU,
REJECT_DATETIME,
--DRIVEWAY,
REJECT_REASON AS SYM_REJECT_REASON,
B.WM_REJECT_REASON
FROM `wmt-edw-sandbox.SYMBOTIC_DATA.snowflake_rejects_raw`
 
LEFT OUTER JOIN(
  SELECT
  --CORRELATION_ID,
  --EQUIPMENT_NAME,
  --HEIGHT,
  --LENGTH,
  --WIDTH,
  --CAMERA_ID,
  --GROUP_NUMBER,
  --ITEM_NUMBER,
  --MATCHED_GTIN_TYPE,
  LPN_ID,
  JSON_VALUE(EVENT.status) EVENT_STATUS,
  CASE
    WHEN JSON_VALUE(EVENT.status) IN ('VERIFIED', 'BYPASS') THEN NULL -- not rejected
    ELSE JSON_VALUE(EVENT.status)
  END WM_REJECT_REASON,
  CASE
    WHEN JSON_VALUE(EVENT.status) IN ('VERIFIED', 'BYPASS') THEN NULL -- not rejected
    WHEN JSON_VALUE(EVENT.status) IN ('FLIB_DIVERT', 'FLIB_INELIGIBLE') THEN 'SYM Rejected'
    ELSE 'Customer Rejected'
  END REJECT_SOURCE
 
  FROM `wmt-edw-prod.US_SUPPLY_CHAIN_SCT_NONCAT_VM.HAWKEYE_BQ_VIEW_INBOUND`
  WHERE EVENT_TYPE = 'LABEL_VERIFICATION'
  AND DC_NUMBER = '06035'
)B
ON LPN = B.LPN_ID
 
WHERE DC = '6035'
AND DRIVEWAY LIKE '%FLIB%'
AND DATE(BUSINESS_DATE) between DATE(2026,1,14) and DATE(2026,1,15)
)
 
